
CREATE DATABASE KUTUPHANELER;
use KUTUPHANELER;

CREATE TABLE UYELER(
    UYENO int not null primary key identity(1,1),
    UYEADI nvarchar(100) not null,
    UYESOYADI nvarchar(100) not null,
    EPOSTA nvarchar(200) not null,
    CINSIYET char(10),
    TELEFON char(11)
);

CREATE TABLE ADRES(
    ADRESNO int not null primary key identity(1,1),
    SEHIR nvarchar(20),
    MAHALLE nvarchar(100),
    BINANO int,
    CADDE nvarchar(300),
    ULKE nvarchar(100),
    POSTAKODU int
);

CREATE TABLE KUTUPHANE(
    KUTUPHANENO int not null primary key identity(1,1),
    KUTUPAHENEISMI nvarchar(200),
    ACIKLAMA nvarchar(1000)
);

CREATE TABLE KITAP(
    SAYFASAYISI int,
    KITAPADI nvarchar(200),
    ISBN nvarchar(15) primary key not null,
    YAYINTARIHI datetime
);

CREATE TABLE EMANETLER(
    EMANETTARIHI datetime,
    EMANETNO int primary key identity(1,1) not null,
    TESLIMTARIHI datetime

);

CREATE TABLE KATEGORILER(
    KATEGORINO int primary key identity(1,1) not null,
    KATEGORIADI nvarchar(100)
);

CREATE TABLE YAZAR(
    YAZARNO int primary key identity(1,1) not null,
    YAZARADI nvarchar(50),
    YAZARSOYADI nvarchar(50)
);

CREATE TABLE KUTUPHANE_KITAPLARI (
    KUTUPHANENO int,
    ISBN nvarchar(15),
    MIKTAR INT,
    PRIMARY KEY (KUTUPHANENO, ISBN),
    FOREIGN KEY (KUTUPHANENO) REFERENCES KUTUPHANE(KUTUPHANENO),
    FOREIGN KEY (ISBN) REFERENCES KITAPLAR(ISBN)
);

CREATE TABLE KITAP_KATEGORI (
    ISBN nvarchar(15),
    KATEGORINO int,
    PRIMARY KEY (ISBN, KATEGORINO),
    FOREIGN KEY (ISBN) REFERENCES KITAPLAR(ISBN),
    FOREIGN KEY (KATEGORINO) REFERENCES KATEGORILER(KATEGORINO)
);

CREATE TABLE KITAP_YAZAR (
    ISBN nvarchar(15),
    YAZARNO int,
    PRIMARY KEY (ISBN, YAZARNO),
    FOREIGN KEY (ISBN) REFERENCES KITAPLAR(ISBN),
    FOREIGN KEY (YAZARNO) REFERENCES YAZARLAR(YAZARNO)
);




ALTER TABLE ADRES
    ADD KUTUPHANENO INT CONSTRAINT FK_ADRES_KUTUPHANE FOREIGN KEY (KUTUPHANENO) REFERENCES KUTUPHANE (KUTUPHANENO);

ALTER TABLE ADRES
    ADD UYENO INT CONSTRAINT FK_ADRES_UYE FOREIGN KEY (UYENO) REFERENCES UYELER(UYENO);

ALTER TABLE EMANETLER
    ADD UYENO INT CONSTRAINT FK_EMANET_UYE FOREIGN KEY (UYENO) REFERENCES UYELER (UYENO);

ALTER TABLE EMANETLER
    ADD KUTUPHANENO INT CONSTRAINT FK_EMANET_KUTUPHANE FOREIGN KEY (KUTUPHANENO) REFERENCES KUTUPHANE(KUTUPHANENO);

ALTER TABLE EMANETLER
    ADD ISBN NVARCHAR(13) CONSTRAINT FK_EMANET_KITAP FOREIGN KEY (ISBN) REFERENCES KITAPLAR(ISBN);
